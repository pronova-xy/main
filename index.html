<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frozo Store - Categories & Products</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Load Stripe Buy Button script once globally -->
  <script async src="https://js.stripe.com/v3/buy-button.js"></script>

  <style>
    @keyframes move {
      100% {
          transform: translate3d(0, 0, 1px) rotate(360deg);
      }
    }

    .background {
        position: fixed;
        width: 100vw;
        height: 100vh;
        top: 0;
        left: 0;
        background: #000b19;
        overflow: hidden;
        z-index: -1; /* put background behind content */
    }

    .background span {
        width: 20vmin;
        height: 20vmin;
        border-radius: 20vmin;
        backface-visibility: hidden;
        position: absolute;
        animation: move;
        animation-duration: 45s;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
    }

    .background span:nth-child(1) {
    color: #5d00ff;
    top: 41%;
    left: 64%;
    animation-duration: 50s;
    animation-delay: -29s;
    transform-origin: -14vw -11vh;
    box-shadow: 40vmin 0 5.33vmin currentColor;
}
.background span:nth-child(2) {
    color: #5d00ff;
    top: 65%;
    left: 80%;
    animation-duration: 55s;
    animation-delay: -12s;
    transform-origin: 14vw 5vh;
    box-shadow: -40vmin 0 5.46vmin currentColor;
}
.background span:nth-child(3) {
    color: #5d00ff;
    top: 31%;
    left: 4%;
    animation-duration: 16s;
    animation-delay: -41s;
    transform-origin: 12vw 19vh;
    box-shadow: 40vmin 0 5.74vmin currentColor;
}
.background span:nth-child(4) {
    color: #00aaff;
    top: 38%;
    left: 20%;
    animation-duration: 53s;
    animation-delay: -13s;
    transform-origin: 7vw -1vh;
    box-shadow: -40vmin 0 5.61vmin currentColor;
}
.background span:nth-child(5) {
    color: #5d00ff;
    top: 50%;
    left: 10%;
    animation-duration: 48s;
    animation-delay: -22s;
    transform-origin: -10vw 8vh;
    box-shadow: 35vmin 0 5.40vmin currentColor;
}
.background span:nth-child(6) {
    color: #00aaff;
    top: 70%;
    left: 55%;
    animation-duration: 60s;
    animation-delay: -17s;
    transform-origin: 15vw -10vh;
    box-shadow: -38vmin 0 5.50vmin currentColor;
}
.background span:nth-child(7) {
    color: #5d00ff;
    top: 22%;
    left: 70%;
    animation-duration: 45s;
    animation-delay: -30s;
    transform-origin: 20vw 12vh;
    box-shadow: 42vmin 0 5.60vmin currentColor;
}
.background span:nth-child(8) {
    color: #00aaff;
    top: 60%;
    left: 25%;
    animation-duration: 52s;
    animation-delay: -15s;
    transform-origin: -18vw -8vh;
    box-shadow: -45vmin 0 5.52vmin currentColor;
}
.background span:nth-child(9) {
    color: #5d00ff;
    top: 33%;
    left: 35%;
    animation-duration: 50s;
    animation-delay: -40s;
    transform-origin: 10vw 6vh;
    box-shadow: 38vmin 0 5.58vmin currentColor;
}
.background span:nth-child(10) {
    color: #00aaff;
    top: 44%;
    left: 45%;
    animation-duration: 58s;
    animation-delay: -23s;
    transform-origin: -13vw 10vh;
    box-shadow: -42vmin 0 5.60vmin currentColor;
}
.background span:nth-child(11) {
    color: #5d00ff;
    top: 27%;
    left: 50%;
    animation-duration: 47s;
    animation-delay: -38s;
    transform-origin: 16vw -5vh;
    box-shadow: 40vmin 0 5.62vmin currentColor;
}
.background span:nth-child(12) {
    color: #00aaff;
    top: 59%;
    left: 15%;
    animation-duration: 54s;
    animation-delay: -14s;
    transform-origin: -17vw 7vh;
    box-shadow: -37vmin 0 5.64vmin currentColor;
}
.background span:nth-child(13) {
    color: #5d00ff;
    top: 35%;
    left: 75%;
    animation-duration: 49s;
    animation-delay: -28s;
    transform-origin: 13vw 14vh;
    box-shadow: 39vmin 0 5.66vmin currentColor;
}
.background span:nth-child(14) {
    color: #00aaff;
    top: 40%;
    left: 85%;
    animation-duration: 57s;
    animation-delay: -16s;
    transform-origin: -12vw -12vh;
    box-shadow: -43vmin 0 5.68vmin currentColor;
}
.background span:nth-child(15) {
    color: #5d00ff;
    top: 55%;
    left: 60%;
    animation-duration: 51s;
    animation-delay: -31s;
    transform-origin: 11vw 11vh;
    box-shadow: 41vmin 0 5.70vmin currentColor;
}
.background span:nth-child(16) {
    color: #00aaff;
    top: 25%;
    left: 30%;
    animation-duration: 56s;
    animation-delay: -19s;
    transform-origin: -15vw 4vh;
    box-shadow: -40vmin 0 5.72vmin currentColor;
}
.background span:nth-child(17) {
    color: #5d00ff;
    top: 48%;
    left: 5%;
    animation-duration: 46s;
    animation-delay: -33s;
    transform-origin: 18vw -9vh;
    box-shadow: 37vmin 0 5.74vmin currentColor;
}
.background span:nth-child(18) {
    color: #00aaff;
    top: 36%;
    left: 50%;
    animation-duration: 59s;
    animation-delay: -13s;
    transform-origin: -14vw 15vh;
    box-shadow: -39vmin 0 5.76vmin currentColor;
}
.background span:nth-child(19) {
    color: #5d00ff;
    top: 63%;
    left: 40%;
    animation-duration: 53s;
    animation-delay: -20s;
    transform-origin: 16vw 9vh;
    box-shadow: 40vmin 0 5.78vmin currentColor;
}
.background span:nth-child(20) {
    color: #00aaff;
    top: 29%;
    left: 65%;
    animation-duration: 54s;
    animation-delay: -21s;
    transform-origin: -11vw -6vh;
    box-shadow: -38vmin 0 5.80vmin currentColor;
}
.background span:nth-child(21) {
    color: #5d00ff;
    top: 42%;
    left: 75%;
    animation-duration: 52s;
    animation-delay: -18s;
    transform-origin: 14vw 13vh;
    box-shadow: 41vmin 0 5.82vmin currentColor;
}
.background span:nth-child(22) {
    color: #00aaff;
    top: 57%;
    left: 35%;
    animation-duration: 55s;
    animation-delay: -25s;
    transform-origin: -13vw 8vh;
    box-shadow: -40vmin 0 5.84vmin currentColor;
}
.background span:nth-child(23) {
    color: #5d00ff;
    top: 39%;
    left: 20%;
    animation-duration: 50s;
    animation-delay: -27s;
    transform-origin: 12vw -7vh;
    box-shadow: 38vmin 0 5.86vmin currentColor;
}

  </style>
</head>
<body>
  
  <div class="background">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>

  <header>
    <h1>Frozone Store</h1>
    <h3>your number 1 for cheap products</h3>
  </header>
  
  <section class="categories" id="category-list">
    <!-- Categories will load here -->
  </section>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span id="modal-close" class="close">&times;</span>
      <h2 id="modal-title"></h2>

      <!-- Products list -->
      <div id="modal-products" class="modal-products"></div>

      <!-- Single product details, hidden by default -->
      <div id="modal-product-detail" class="modal-product-detail" style="display:none;">
        <button id="back-to-products" class="back-button">← Back to products</button>
        <h3 id="detail-name"></h3>
        <img id="detail-image" src="" alt="" />
        <p><strong>Price:</strong> $<span id="detail-price"></span></p>
        <p><strong>Stock:</strong> <span id="detail-stock"></span></p>
        <p id="detail-description"></p>
        <!-- Stripe Buy Button container -->
        <div id="buy-button-container" style="margin-top: 1rem;"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyD9imRu3ckf2bE6J9izCm43rnAGXOiqvSA",
  authDomain: "smol-devs.firebaseapp.com",
  projectId: "smol-devs",
  storageBucket: "smol-devs.firebasestorage.app",
  messagingSenderId: "675801229903",
  appId: "1:675801229903:web:8d366648305b0731f8183a",
  measurementId: "G-RJ1NS8E4K9"
};

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const categoryList = document.getElementById('category-list');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalProducts = document.getElementById('modal-products');
    const modalProductDetail = document.getElementById('modal-product-detail');
    const modalClose = document.getElementById('modal-close');
    const backToProductsBtn = document.getElementById('back-to-products');

    // Detail elements
    const detailName = document.getElementById('detail-name');
    const detailImage = document.getElementById('detail-image');
    const detailPrice = document.getElementById('detail-price');
    const detailStock = document.getElementById('detail-stock');
    const detailDescription = document.getElementById('detail-description');
    const buyButtonContainer = document.getElementById('buy-button-container');

    // Load categories from Firestore
    async function loadCategories() {
      const categoriesSnapshot = await getDocs(collection(db, "categories"));
      if (categoriesSnapshot.empty) {
        categoryList.innerHTML = '<p>No categories found.</p>';
        return;
      }
      categoryList.innerHTML = '';
      categoriesSnapshot.forEach(doc => {
        const categoryId = doc.id;
        const div = document.createElement('div');
        div.className = 'category-card';
        div.textContent = categoryId.charAt(0).toUpperCase() + categoryId.slice(1);
        div.onclick = () => openCategoryModal(categoryId);
        categoryList.appendChild(div);
      });
    }

    // Show product list for a category
    async function openCategoryModal(categoryId) {
      modalTitle.textContent = categoryId.charAt(0).toUpperCase() + categoryId.slice(1);
      modalProducts.innerHTML = 'Loading...';
      modalProducts.style.display = 'grid';
      modalProductDetail.style.display = 'none';

      const productsRef = collection(db, "categories", categoryId, "products");
      const productsSnapshot = await getDocs(productsRef);

      if (productsSnapshot.empty) {
        modalProducts.innerHTML = '<p>No items found in this category.</p>';
      } else {
        modalProducts.innerHTML = '';
        productsSnapshot.forEach(doc => {
          const data = doc.data();
          const productCard = document.createElement('div');
          productCard.className = 'product-card';
          productCard.innerHTML = `
            <img src="${data.image || 'https://via.placeholder.com/150'}" alt="${data.name}" />
            <h4>${data.name}</h4>
            <p>$${data.price?.toFixed(2) || '0.00'}</p>
          `;
          productCard.onclick = () => showProductDetail(data);
          modalProducts.appendChild(productCard);
        });
      }

      modal.style.display = "block";
    }

    // Show single product detail in modal
    function showProductDetail(product) {
      modalTitle.textContent = product.name;
      detailName.textContent = product.name;
      detailImage.src = product.image || 'https://via.placeholder.com/300x200';
      detailImage.alt = product.name;
      detailPrice.textContent = product.price?.toFixed(2) || '0.00';
       detailStock.textContent = (product.stock < 0) ? '∞' : (product.stock ?? 'N/A');
      detailDescription.textContent = product.description || '';

      // Inject Stripe buy button HTML (just the <stripe-buy-button> tag)
      buyButtonContainer.innerHTML = product.button || '';

      modalProducts.style.display = 'none';
      modalProductDetail.style.display = 'block';
    }

    // Close modal
    modalClose.onclick = () => {
      modal.style.display = "none";
    };

    // Back to products list
    backToProductsBtn.onclick = () => {
      modalProductDetail.style.display = 'none';
      modalProducts.style.display = 'grid';
      // Reset modal title if needed (category name)
    };

    // Close modal if click outside content
    window.onclick = (event) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    };

    loadCategories();
  </script>
</body>
</html>
